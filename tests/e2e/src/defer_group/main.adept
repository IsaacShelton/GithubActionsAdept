
pragma null_checks
import basics

record Node (next *Node)

func main {
    multiLine()
    singleLine()
}

func multiLine {
    node2 *Node = new Node
    node2.next = null

    node1 *Node = new Node
    node1.next = node2

    defer {
        // These statements will execute sequentially,
        // (unlike multiple 'defer' statements)

        delete node1.next
        node1.next = 0x01 as ptr

        delete node1
        node1 = 0x01 as ptr
    }
}

func singleLine {
    node2 *Node = new Node
    node2.next = null

    node1 *Node = new Node
    node1.next = node2

    // These statements will execute sequentially,
    // (unlike multiple 'defer' statements)
    defer print("starting"); delete node1.next; node1.next = 0x01 as ptr; delete node1; node1 = 0x01 as ptr; print("ok")
}
